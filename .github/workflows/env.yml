# on:
#  workflow_call:
#     inputs:
#       name:
#         description: 'username'
#         required: false
#         type: string
#       environment:
#         description: 'Environment to run tests against'
#         type: string
#         required: true
       

# jobs:
#   log-the-inputs:
#     runs-on: ubuntu-latest
#     steps:
#       - run: |
#           echo "Log level: $LEVEL"
#           echo "name: $NAME"
#           echo "Environment: $ENVIRONMENT"
#         env:
#           LEVEL: ${{ inputs.logLevel }}
#           NAME: ${{ inputs.name }}
#           ENVIRONMENT: ${{ inputs.environment }}


name: Conditional Trigger Workflow

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'Username'
        required: false
        type: string
      environment:
        description: 'Environment to run tests against'
        type: choice
        required: true
        options: 
          - stagging
          - dev
          - prod
          - stagging new

jobs:
  log_and_trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Log the inputs
        id: log_inputs
        run: |
          echo "name: ${{ github.event.inputs.name }}"
          echo "Environment: ${{ github.event.inputs.environment }}"

      - name: Conditionally trigger workflow
        if: ${{ github.event.inputs.environment == 'stagging' }}
        run: |
          curl -X POST \
            -H "Authorization: token ${{ secrets.TOKEN_GITHUB }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/RinkuRao04/ENV_trigger/dispatches \
            -d '{
              "ref": "main",
              "inputs": {
                "name": "${{ github.event.inputs.name }}",
                "environment": "stagging new"
              }
            }'

      - name: Confirm action
        run: echo "Completed conditional trigger check."

